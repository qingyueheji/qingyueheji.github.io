{"version":3,"sources":["cropbox.js"],"names":["factory","define","amd","jQuery","$","cropbox","options","el","imgMouseDown","e","obj","state","dragable","clientX","mouseX","imgMouseMove","bg","bgX","css","split","x","parseInt","bgY","imgMouseUp","stopImmediatePropagation","zoomImage","wheelDelta","originalEvent","detail","ratio","imageBox","find","thumbBox","spinner","image","getDataURL","width","this","height","document","createElement","canvas","dim","size","dx","dy","dw","dh","sh","imageData","getContext","context","sw","getBlob","array","b64","replace","binary","atob","i","length","push","Blob","Uint8Array","type","zoomIn","setBackground","zoomOut","pw","w","h","ph","background-image","src","background-size","background-position","background-repeat","show","hide","bind","window","imgSrc","on","unbind","fn"],"mappings":"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","file":"../cropbox.min.js","sourcesContent":["/**\r\n * Created by ezgoing on 14/9/2014.\r\n */\r\n\r\n\"use strict\";\r\n(function (factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        define(['jquery'], factory);\r\n    } else {\r\n        factory(jQuery);\r\n    }\r\n}(function ($) {\r\n    var cropbox = function (options, el) {\r\n        var el = el || $(options.imageBox),\r\n            obj = {\r\n                state: {},\r\n                ratio: 1,\r\n                options: options,\r\n                imageBox: el,\r\n                thumbBox: el.find(options.thumbBox),\r\n                spinner: el.find(options.spinner),\r\n                image: new Image(),\r\n                getDataURL: function () {\r\n                    try {\r\n                        var width = this.thumbBox.width(),\r\n                            height = this.thumbBox.height(),\r\n                            canvas = document.createElement(\"canvas\"),\r\n                            dim = el.css('background-position').split(' '),\r\n                            size = el.css('background-size').split(' '),\r\n                            dx = parseInt(dim[0]) - el.width() / 2 + width / 2,\r\n                            dy = parseInt(dim[1]) - el.height() / 2 + height / 2,\r\n                            dw = parseInt(size[0]),\r\n                            dh = parseInt(size[1]),\r\n                            sh = parseInt(this.image.height),\r\n                            sw = parseInt(this.image.width);\r\n\r\n                        canvas.width = width;\r\n                        canvas.height = height;\r\n                        var context = canvas.getContext(\"2d\");\r\n                        context.drawImage(this.image, 0, 0, sw, sh, dx, dy, dw, dh);\r\n                        var imageData = canvas.toDataURL('image/png');\r\n                        return imageData;\r\n                    } catch (e) {\r\n                        return ''\r\n                    }\r\n                },\r\n                getBlob: function () {\r\n                    var imageData = this.getDataURL();\r\n                    var b64 = imageData.replace('data:image/png;base64,', '');\r\n                    var binary = atob(b64);\r\n                    var array = [];\r\n                    for (var i = 0; i < binary.length; i++) {\r\n                        array.push(binary.charCodeAt(i));\r\n                    }\r\n                    return new Blob([new Uint8Array(array)], {type: 'image/png'});\r\n                },\r\n                zoomIn: function () {\r\n                    this.ratio *= 1.1;\r\n                    setBackground();\r\n                },\r\n                zoomOut: function () {\r\n                    this.ratio *= 0.9;\r\n                    setBackground();\r\n                }\r\n            },\r\n            setBackground = function () {\r\n                var w = parseInt(obj.image.width) * obj.ratio;\r\n                var h = parseInt(obj.image.height) * obj.ratio;\r\n\r\n                var pw = (el.width() - w) / 2;\r\n                var ph = (el.height() - h) / 2;\r\n                el.css({\r\n                    'background-image': 'url(' + obj.image.src + ')',\r\n                    'background-size': w + 'px ' + h + 'px',\r\n                    'background-position': pw + 'px ' + ph + 'px',\r\n                    'background-repeat': 'no-repeat'\r\n                });\r\n            },\r\n            imgMouseDown = function (e) {\r\n                e.stopImmediatePropagation();\r\n\r\n                obj.state.dragable = true;\r\n                obj.state.mouseX = e.clientX;\r\n                obj.state.mouseY = e.clientY;\r\n            },\r\n            imgMouseMove = function (e) {\r\n                e.stopImmediatePropagation();\r\n\r\n                if (obj.state.dragable) {\r\n                    var x = e.clientX - obj.state.mouseX;\r\n                    var y = e.clientY - obj.state.mouseY;\r\n\r\n                    var bg = el.css('background-position').split(' ');\r\n\r\n                    var bgX = x + parseInt(bg[0]);\r\n                    var bgY = y + parseInt(bg[1]);\r\n\r\n                    el.css('background-position', bgX + 'px ' + bgY + 'px');\r\n\r\n                    obj.state.mouseX = e.clientX;\r\n                    obj.state.mouseY = e.clientY;\r\n                }\r\n            },\r\n            imgMouseUp = function (e) {\r\n                e.stopImmediatePropagation();\r\n                obj.state.dragable = false;\r\n            },\r\n            zoomImage = function (e) {\r\n                e.originalEvent.wheelDelta > 0 || e.originalEvent.detail < 0 ? obj.ratio *= 1.1 : obj.ratio *= 0.9;\r\n                setBackground();\r\n            };\r\n\r\n        obj.spinner.show();\r\n        obj.image.onload = function () {\r\n            obj.spinner.hide();\r\n            setBackground();\r\n\r\n            el.bind('mousedown', imgMouseDown);\r\n            el.bind('mousemove', imgMouseMove);\r\n            $(window).bind('mouseup', imgMouseUp);\r\n            el.bind('mousewheel DOMMouseScroll', zoomImage);\r\n        };\r\n        obj.image.src = options.imgSrc;\r\n        el.on('remove', function () {\r\n            $(window).unbind('mouseup', imgMouseUp)\r\n        });\r\n\r\n        return obj;\r\n    };\r\n\r\n    jQuery.fn.cropbox = function (options) {\r\n        return new cropbox(options, this);\r\n    };\r\n}));\r\n\r\n\r\n"]}