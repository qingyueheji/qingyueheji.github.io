"use strict";!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(r){function e(t,m){function e(t){t.stopImmediatePropagation(),s.state.dragable=!0,s.state.mouseX=t.clientX,s.state.mouseY=t.clientY}function n(t){var e,n,i,a,o;t.stopImmediatePropagation(),s.state.dragable&&(e=t.clientX-s.state.mouseX,n=t.clientY-s.state.mouseY,i=m.css("background-position").split(" "),a=e+parseInt(i[0]),o=n+parseInt(i[1]),m.css("background-position",a+"px "+o+"px"),s.state.mouseX=t.clientX,s.state.mouseY=t.clientY)}function i(t){t.stopImmediatePropagation(),s.state.dragable=!1}function a(t){0<t.originalEvent.wheelDelta||t.originalEvent.detail<0?s.ratio*=1.1:s.ratio*=.9,o()}var s={state:{},ratio:1,options:t,imageBox:m=m||r(t.imageBox),thumbBox:m.find(t.thumbBox),spinner:m.find(t.spinner),image:new Image,getDataURL:function(){try{var t=this.thumbBox.width(),e=this.thumbBox.height(),n=document.createElement("canvas"),i=m.css("background-position").split(" "),a=m.css("background-size").split(" "),o=parseInt(i[0])-m.width()/2+t/2,s=parseInt(i[1])-m.height()/2+e/2,r=parseInt(a[0]),u=parseInt(a[1]),c=parseInt(this.image.height),g=parseInt(this.image.width);return n.width=t,n.height=e,n.getContext("2d").drawImage(this.image,0,0,g,c,o,s,r,u),n.toDataURL("image/png")}catch(t){return""}},getBlob:function(){for(var t=this.getDataURL().replace("data:image/png;base64,",""),e=atob(t),n=[],i=0;i<e.length;i++)n.push(e.charCodeAt(i));return new Blob([new Uint8Array(n)],{type:"image/png"})},zoomIn:function(){this.ratio*=1.1,o()},zoomOut:function(){this.ratio*=.9,o()}},o=function(){var t=parseInt(s.image.width)*s.ratio,e=parseInt(s.image.height)*s.ratio,n=(m.width()-t)/2,i=(m.height()-e)/2;m.css({"background-image":"url("+s.image.src+")","background-size":t+"px "+e+"px","background-position":n+"px "+i+"px","background-repeat":"no-repeat"})};return s.spinner.show(),s.image.onload=function(){s.spinner.hide(),o(),m.bind("mousedown",e),m.bind("mousemove",n),r(window).bind("mouseup",i),m.bind("mousewheel DOMMouseScroll",a)},s.image.src=t.imgSrc,m.on("remove",function(){r(window).unbind("mouseup",i)}),s}jQuery.fn.cropbox=function(t){return new e(t,this)}});